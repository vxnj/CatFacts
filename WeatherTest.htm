<!DOCTYPE html>
<html>
<head>

<link rel="stylesheet" href="style.css" />
<script src="funcs.js"></script>
<script src="fDate.js"></script>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Store XMLHttpRequest and the JSON file location in variables
var xhr = new XMLHttpRequest();
var url = "https://api.openweathermap.org/data/2.5/onecall?lat=40.8&lon=-73.97&units=imperial&exclude=minutely&appid=3eaa5145be3fbca4b9a3f346b0f8a668";

// Called whenever the readyState attribute changes 
xhr.onreadystatechange = function() { // Check if fetch request is done
  if (xhr.readyState == 4 && xhr.status == 200) { 
    var jsonData = JSON.parse(xhr.responseText);
    getWea(jsonData);
  }
};

// Do the HTTP call using the url variable we specified above
function wea() {
  xhr.open("GET", url, true);
  xhr.send();
}

var tblhr = '<table class="table"><thead><tr>'
      + '<th>Time</th>'
      + '<th>Temp</th>'
      + '<th>Humid</th>'
      + '<th>Weather</th>'
    +'</tr></thead>';

// Function that formats the string with HTML tags, then outputs the result
function getWea(data) {

      tblhr += "<tr>" 
            + "  <td>" + "Now" + "</td>"
            + '  <td class="hl"><b>' + parseInt(.5 + data.current.temp) + "°</b></td>"
            + "  <td>" + data.current.humidity + "%" + "</td>"
            + "  <td>" + data.current.weather[0].main + "</td>"
           // + "  <td>" + '<img src="http://openweathermap.org/img/wn/' + data.current.weather[0].icon + '@2x.png" style="width:32px;height:32px;">' + "</td>"
            + "</tr>";
    
    let txt = "";
    for (let i = 1; i < 10; i++) {
      
      var xd = new Date(data.hourly[i].dt*1000);
      xicon = '<img src="http://openweathermap.org/img/wn/' + data.hourly[i].weather[0].icon + "@2x.png>";
      console.log(xicon)
      xd2 = xd.toLocaleString('en-US', { hour: 'numeric', hour12: true });
      
      tblhr += "<tr>" 
            + "  <td>" + xd.toLocaleString('en-US', { hour: 'numeric', hour12: true }) + "</td>"
            + "  <td>" + parseInt(.5 + data.hourly[i].temp) + "°</td>"
            + "  <td>" + data.hourly[i].humidity + "%" + "</td>"
            + "  <td>" + data.hourly[i].weather[0].main + "</td>"
           // + "  <td>" + '<img src="http://openweathermap.org/img/wn/' + data.hourly[i].weather[0].icon + '@2x.png" style="width:32px;height:32px;">' + "</td>"
            + "</tr>";
   }
 
   tblhr += "</tbody></table>";


   var dateVal = new Date(data.current.sunrise *1000);
   rise = date_format(dateVal, 'h:ia');
   dateVal = new Date(data.current.sunset  *1000);
   set =  date_format(dateVal, 'h:ia');

  console.log(rise)

   document.getElementById("tblhr").innerHTML = tblhr;
   document.getElementById("sun").innerHTML = rise + " | " + set


 }

window.onload = wea;

</script>

<title>weather</title>
</head>
<body>


<br>




<div id="tblhr"></div>
<div id="sun"></div>

<a href="https://api.openweathermap.org/data/2.5/onecall?lat=40.8&lon=-73.97&units=imperial&exclude=minutely&appid=3eaa5145be3fbca4b9a3f346b0f8a668"
target="blank">json<a/>

<a href="https://vxnj.github.io/CatFacts/WeatherTest.htm"">github<a/>
<a href="https://duckduckgo.com/?q=weather+upper+west+side%2C+Ny&t=ffsb&atb=v229-1&ia=weather" target="blank">ddg weather<a/>
<a href="https://openweathermap.org/city/5128581">open wea<a/>

</body>
</html>